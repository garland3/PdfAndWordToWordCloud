Journal of Mechanical Design

Special Issue 2015: Design for Additive Manufacturing

Design and Manufacturing Functionally Gradient Material Objects With an Off the Shelf 3D Printer: Challenges and Solutions

Anthony Garland, Georges Fadel

Clemson University

Clemson, SC, USA

apg@clemson.edu, fgeorge@clemson.edu

Abstract

This paper presents the challenges and solutions encountered while designing and then printing functionally gradient material (FGM) objects using an off the shelf Fused Deposition Modeling (FDM) 3D printer. The printer, Big Builder Dual-Feed Extruder from 3dprinter4u, has the unique design of extruding two different filaments out of one nozzle. By controlling the rate at which the two filaments are pulled into the melt chamber, FGM objects can be printed. Software challenges associated with process planning required to print a FGM object are solved by showing a method for printing a discretized gradient and by designing an open loop control mechanism for the extruder motors. A design method is proposed that models an object using a level set function with a material gradient. Instead of merely identifying the boundaries of the object, the level set also models the material gradient within the object. This representation method along with a genetic algorithm finds an optimal design for a FGM cantilever beam that is then printed on the FDM printer. The model and genetic algorithm are also used to solve a standard topology optimization problem. The results are compared to a similar FGM topology optimization method in the literature. All of the code for this paper is made open source to facilitate future research.  

INTRODUCTION

Functionally gradient material (FGM) broadens an artifacts design space by allowing an engineer to customize different regions of an object to have different material properties.  In essence, FGM objects enable engineers to tailor an object’s design beyond merely changing the physical shape of the object to meet design objectives and constraints [1]. Composite materials also take advantage of several different material property characteristics within a single object, but composite materials may fail by delaminating [2] and have only a one-dimensional material variation (layers). In contrast, FGM objects have no clear boundary between materials but instead have a smooth transition between material types.

 Designing FGM objects is difficult because the engineer can modify not only an object’s topology or shape, but also its internal material distribution to achieve design objectives. The design space becomes so broad that some sort of optimization should be used to design simultaneously the topology and material distribution. Additionally, manufacturing constraints likely will limit the design space and should be considered while designing. 

Engineers can manufacture FGM parts using several different methods. These manufacturing methods include centrifugal casting, using electric or magnetic fields while casting, squeeze casting, surface treating, and other uncommon techniques [1]. In contrast to these complex manufacturing techniques, additive manufacturing (AM) gives the engineer another method of manufacturing FGM objects that is simpler. Because most AM techniques work by moving a tool in a prescribed path while depositing material, changing the composition of the material while the tool is moving allows AM to produce FGM objects. Laser engineering net shaping (LENS), ultrasonic consolidation (UC), inkjet photo cured resin, and fused deposition modeling (FDM) are some of the additive manufacturing methods capable of producing FGM objects. This paper focuses on the use of an inexpensive FDM machine, Big Builder Dual-Feed Extruder, to produce FGM objects. 

The recent explosion of new companies selling FDM machines has contributed to a dramatic decrease in their cost. Most of these new printers derive from the RepRap printer which was originally designed to be a self-replicating printer [3]. Although, no printer has fully achieved self-replication, the open source firmware developed for the RepRap printer and the inexpensive Arduino Mega that runs the firmware have become the main software and micro controller used in many of the new low cost printers.  Because the firmware, slicers, and printer setup and control software are entirely open source, the significant software development cost associated with developing a 3D printer reduces to zero. Most of the new FDM printers on the market use these open source software tools and cut the cost of a FDM printer to a few hundred or thousand dollars. In addition, some 3D printer manufacturers have made the hardware design of their printer open source as well.

 In this paper, we examine the capabilities of one of these new 3D printers, Big Builder Dual-Feed Extruder from 3dprinter4u, that is based on the RepRap firmware and software tool chain. The Big Builder gets its name from the large Z height (664 mm) that it is able to print, although its X and Y build volume dimensions (220 by 210 mm) are not much larger than most low cost printers. The Big Builder’s unique design takes two filaments going into the same melting chamber, and extrudes both filaments at the same time based on a changeable ratio. This design lets the engineer change the composition of the material while printing. If the same material composition, but different color filaments are used, the printer manufactures an object with a color gradient. If different materials are used, then the printer manufactures an object with functionally gradient properties.

Table 1. AM Machines Capable Of Manufacturing FGM Objects 

Printer name

Technology

Gradient directions

Materials

Build volume, mm

Cost

Manufacturer

Connex3 3D

PolyJet, photo cured resin

X,Y,Z

Photo Cured Plastics

255 × 252 × 200

~$350K

Stratasys

LENS 450

Laser Engineering Net Shaping

X,Y,Z

Metals

100 x 100 x 100

~$300K

Optomec

SonicLayer R200

Ultrasonic Consolidation

Z

Metal

508 x 304 x 152 

~$300K

Fabrisonic

Big Builder

Fusion deposition modeling

X,Y,Z

Filament Thermoplastics

220 x 210 x 664

~$3K

3dprinter4u

Designing and manufacturing FGM objects using an AM machine is a challenging task no matter what particular machine is used. All AM machines that print FGM objects experience many of the same difficulties. These difficulties include manufacturing validation, finding a suitable representation of an artifact, optimizing designs, finding optimal tool paths, and developing a complete software tool chain for design to manufacturing [4]. Unfortunately, most AM machines capable of printing FGM objects are very expensive which prohibits research to help solve some these issues. Table 1 provides a summary of a few machines. Because of the low cost, inexpensive printing material, open source software tool chain (which can be modified for research), and short learning curve, the Big Builder is an excellent printer to experiment with in order to solve many of the difficulties associated with printing FGM objects. 

First, a review of previous works in design and manufacturing FGM shows some of the difficulties encountered. Second, the results of experiments using the Big Builder 3D printer are presented along with methods of solving some of the software issues encountered while printing FGM objects. Limitations of the FDM printer are also discussed. Finally, a new model of FGM objects is presented that allows for topology and material optimization at the same time. The optimal design found by the optimizer is compared to other optimization methods found in the literature. 

Literature review

Many researchers have sought to design, represent, and manufacture FGM objects. In general, the first problems encountered while working with FGM objects is finding a suitable model for the artifact. Many models exist for representing the outer shape of an object, but modeling the inner composition of an object is more difficult. Most internal composition models fall into two broad categories, either discretized representations or function-based representations.  The discretized model requires specifying the composition of every voxel within an artifact. Obviously, for large models the discretized model contains an enormous amount of data that can make working with these models difficult. The size of individual voxels is another parameter which in principle should be related to the amount of material volume deposited and which dictates the fidelity of the manufactured part to the designed part. Many researchers have made modifications and improvements to the pure voxel representation [5]. Modeling and designing FGM objects using voxels is difficult because the composition of each voxel is a design variable, and the large number of design variables makes the design extremely complex.

Function based models use a global function or piecewise blending functions in different regions to represent mathematically the volume fraction composition of an artifact at each point.  A simple normalized global function easily represents simple internal composition variations. For example, V can represent the volume fraction composition of a material at each point  within the object using this normalized function,

((1)

where  is the maximum possible value of  in the domain, and  represents some material distribution function. For complex geometries, this representation often does not work well [6]. Researchers also commonly use the distance from one or more control points to represent volume fraction composition [7, 8]. Finding a suitable model for use by both an optimizer and an engineer in a CAD environment is an area of continuing research. Tan and coworkers present a comprehensive literature study of the various types of models used to represent FGM objects [6]. 

Design of FGM

In general, an optimal FGM part has an optimal outer geometry (shape), inner holes (topology), and an optimal material composition [9-12]. Many researchers have found optimal material compositions using function based representation [5, 7, 13-18]. In addition, topology optimization research is full of many techniques for finding optimal object topology. Merging these two optimizations together is needed to create fully optimal designs [4]. Ramani discretizes a gradient into ten regions and then uses a multi-material topology optimization algorithm to decide on the boundaries of the object and then what gradient should be placed within the object [19]. Xia and Wang developed a level set topology optimization for FGM materials where the internal material model is a discretized scalar field [20]. They insure continuity of the discretized model by introducing a penalty for gradients into their objective function. Their work is, to our knowledge, the most complete attempt at optimizing both topology and material composition at the same time available in the literature [20].

Several researchers have designed topology optimization algorithms that optimize the placement of several different materials simultaneously. Hiller and Lipson use a genetic algorithm to find an optimal beam topology that uses several different materials. The optimization objectives are to minimize weight while making the beam deflect into predetermined shapes [12]. Gao and Zhang use a level set topology optimization to minimize thermal stresses while maximizing overall stiffness of an object with two materials [21]. Other researchers also used the level set approach to design bridge trusses using several different materials with different properties [22]. 

Many researchers have also used function-based representations of internal material composition to make optimal designs [5, 7, 13-18, 23]. Huang and Fadel found an optimal flywheel profile and material composition in order to maximize energy storage and minimize the max internal stress [13]. Kou, Parks, and Tan found the best material distribution within an object in order to minimize internal thermal stress [16]. Hu and coworkers used multi-objective optimization to find an optimal I-beam design that minimized weight, displacement, and manufacturing time on a AM machine. Their result shows that the particular AM process chosen to make the part significantly affects the optimal internal design of the object [24].

Manufacturing FGM

Vaezi and coworkers present a literature review of multi-material additive manufacturing techniques [25].  They found several techniques that have been used to additively manufacture FGM parts; however no FDM process that involve melting and can print FGM are identified by Vaezi and coworkers.

Several researchers have used AM to make FGM objects. Shin et al. used a LENS like process, Direct Metal Deposition (DMD), to produce metal FGM objects [26]. The process injects metal powders into a laser beam induced plasma pool that results in depositing material on a substrate similar to a continuous welding process. The process makes a FGM object by changing the composition of the metal powders being jetted into the laser beam while the depositing head is moving around. Then, Shin et al. designed and manufactured a block that varied from 100% CU to 100% Ni. After making the object, they analyzed the composition within each discretized region and found a wide variability in the volume fraction composition within each region. Similarly, Morvan et al. manufactured the multi-material flywheel discussed earlier on a LENS machine [27]. 

Table 2. 3D Printed Materials

Nylon 618

PLA

Units

Density

1.134 

1.23

 

Tensile strength 

66

56.6 

MPa

Elastic Modulus

1700

3368 

MPa

Elongation at Failure

300

3.8

%

Melting point

218 

175

Degrees C

Printing temperature

235-260 

215

Degrees C

 AM of plastics has received significant research as well. Bruyas and coworker used the Stratasys polyjet to create compliant joints [28]. Keating and Oxman designed a robotic arm that could not only 3D print objects using FDM but also a wide range of other  tasks, such as scanning and laser cutting. Their robotic arm was able to manufacture multi-material objects [29]. Es-Said and co-workers investigated the mechanical properties of objects produced using AM to determine how the layer orientation affect the mechanical properties of the part. The tensile testing results showed that part failure always occurred on layer interfaces [30]. Vega and coworkers also found that AM layer orientations as well as surface roughness play important parts in an object’s overall strength [31].

Experiments

Several different experiments using the Big Builder 3D printer show its ability to manufacture FGM objects and expose its limitations. The Big Builder uses 1.75 mm diameter filament in a variety of common inexpensive 3D printer materials including PLA, ABS, HIPS, and nylon. Nylon and PLA were chosen as the materials for the experiments for several reasons. First, PLA is easy to print whereas ABS, HIPS, and nylon require tighter control of the printing process and surrounding environment. Second, Nylon was chosen because its elastic modulus is significantly different from PLA so that when printed together using a gradient approach, the object will have an elastic modulus gradient. In addition, nylon fails elastically while PLA experiences brittle failure. Table 2 shows the properties of Nylon and PLA.

3D printing a model generally follows a consistent workflow. First, the engineer makes a model in the .stl or AMF format. Second, a slicer program, (for this paper sli3r was used [32]), slices the model into layers and generates a toolpath for the depositing head to follow. The program then exports the results into a Gcode file. Each Gcode file has thousands of individual Gcodes that individually specify the movement of the depositing head and extrusion rate. Next, the 3D printer reads the Gcode and creates the object.

Figure 1. Big Builder Extruder Head

The Big Builder 3D printer has two stepper motors that pull two different filaments into one melt chamber and extrudes material out of one nozzle (Figures 1-2). One of the stepper motors and accompanying filaments is closer to the front of the 3D printer, while the second stepper motor and filament is closer to the rear of the 3D printer. The filaments and extruder motors are differentiated by their front and rear position through this paper.

Figure 2. Simplified Rendering Of The Extruder Head

The Big Builder’s firmware treats both extruder motors as though they were connected to different nozzles where selecting the ‘T0’ or ‘T1’ command causes the printer to switch tools from one filament to the other. In addition to printing one filament or the other, a mixture of the two filaments can be deposited. The ‘G93 RXX.X’ command specifies the extrusion ratio of the rear filament to the front filament where XX.X represents a percentage. For example, ‘G93 R25.1’ results in extruding 25.1% of the rear filament and 74.9% of the front filament. By inserting the G93 command at specific locations within the Gcode the composition of the material being deposited can be changed at any time while printing. Unfortunately, none of the open source slicers, slic3r for this paper, have the ability to insert this G93 command, so a custom Gcode generator or post processing existing Gcode is required in order to create a gradient.

The Big Builder’s inability to interpolate a material change between points was limiting. Ideally, when given the coordinates of two points and the volume fraction composition at each point, the printer should be able to move from one point to the next while changing the material ratio using a linear interpolation. In contrast, the G93 command is essentially a step function. Using the G93 command while printing a gradient line would require breaking the line into many shorter segments, and then sending the G93 command after each segment in order to make a discretized gradient.

Z gradient

In order to test printing FGM objects, a simple object with a material gradient in the Z direction was printed. Adding the Z gradient was relatively simple since only a slight modification to the Gcode for an object was needed. First, a uniform test shape was created to standardize testing. Second, the object was sliced using sli3r. Third, a python program analyzed the Gcode to determine the number of layers, and then the program inserted the G93 commands into the Gcode when the printer would switch to a new layer. The G93 commands instructed the printer to use 0% of the rear filament starting at the bottom layer and linearly interpolate to the top layer of the model where 100% of the rear filament is used. Using the existing slicer software with little modification is a significant advantage since writing a new Gcode generator program requires a significant amount of work. 

Figure 3. Blue PLA Transitioning To Gray PLA. Uneven Mixing From Back (Left) To Front (Right)

Figure 4. Cross Section Rendering Of The Melt Chamber. Uneven Mixing Within The Chamber Causes Stripes To Be Printed And Uneven Mixing From Back To Front Of A Single Object.

Color gradients using two different colors of the same type of material, and FGM objects with nylon and PLA as the two base material objects were printed. A few observations can be made from the prints. First, the mixing of the material inside the extruder is uneven from the back to the front. On all the tests, the front of the object was significantly more grey (grey was in the front extruder) than the back. Figure 3 shows a side-by-side comparison of the front and back of a single. Second, when printing a flat surface with a combination of two materials, the two materials do not mix well and stripes are deposited instead. The material enters the melt chamber on two different sides, and exit through the nozzle on the two different sides. Figure 4 shows how the melt chamber and nozzle design results in the uneven print from back to front and the stripes. Third, sometimes rather than extruding smoothly, globs of one material would be embedded in the other material. 

Finally, printing from a PLA base to nylon helped to minimize warping of the nylon. It was not expected that the nylon would stick to the unheated glass print bed, but by printing a PLA base and transitioning to 100% nylon, warping of the base was minimized. 

The overall quality of the prints we printed with a Z gradient varied widely based on the geometric shape of the object. Interestingly, printing a Z gradient is the only gradient direction the manufacturer of the printer advertises and is a key selling point. 

Discretized Gradient

Generating Gcode with custom python programs is tedious and difficult. A better solution consists in modifying an existing slicer to read not only the geometric model but also the internal composition model and create Gcode considering both models. This improved slicer does not exist, but a work around partially solves the problem. First, standard design tools generate a model. Second, the gradient within the model is discretized, and regions having the same volume fraction composition are defined together using a .stl file. 

For example, assuming the volume fraction composition is discretized into 11 values ranging from 0% to 100%, then all the volumes within the model with a volume fraction composition ranging from 0% to 10% are put into region number one and the boundaries of the region are defined using a .stl file. Third, all the .stl files are put into an AMF file format. AMF files allow the user to define not only the boundaries of each region but also the material of the region. Additionally, the AMF file specifies which nozzle on the 3D printer extrudes each material. Each region is assigned an extruder ranging from 0-11. Next, the AMF file is given to slic3r. Slic3r generates Gcode assuming the printer has 11 extruders. Finally, a small python program reads the Gcode, removes the “change extruder” commands, and replaces them with the change ratio command (G93). For example, the ‘T4’ command that tells the printer to begin using extruder number 4 is changed to ‘G93 R40’ that tells the printer to begin extruding at 40:60 ratio of the two materials. This software tool chain generates the necessary Gcode to produce an object with a discretized gradient. Figure 5 shows the entire software tool chain workflow.

Figure 5. Discretized Gradient Workflow

Figure 6. Functional Gradient Discretized Into 11 Regions

Figure 7. 3D Printed Bar With Discretized Gradient (139.7  mm  By 25.4 mm By 12.7 mm)

Figure 6 shows a representation of how a single model is broken up into regions. Figure 7 shows a test object with 11 discretized regions manufactured on the Big Builder 3D printer. The internal composition model is a simple linear interpolation from 100% orange PLA to 100% blue PLA. Using slic3r to generate the Gcode for the discretized gradient significantly simplified printing a gradient; however several issues exist. First, because each region is printed one at a time, delamination will likely happen on the region boundaries. One of the advantages of FGM objects is a smooth transition between material types, but the gradient discretization and printing one region at a time minimizes this advantage. A better tool path would deposit material while moving back and forth between regions while changing volume compositions in order to eliminate the boundaries between regions. Because FDM AM objects are known to be orthotropic, an optimal toolpath would consider the orthotropic properties. This toolpath design would be similar to the work of Setoodeh and coworkers who found the optimal fiber orientations for an orthotropic material while finding an optimal topology [33].

Response test

In order to test the capabilities of the printer, a simple test was designed to measure the delayed response to changing material. The test consisted of extruding both materials in a rectangle to clean the nozzle and initialize extruding both materials. Then a zigzag pattern was printed. The change material command from 100% of material A to 100% of material B was given at the ends of the zigzag pattern The distance from where the change composition command is given (using G93) to where the material began to change to the new material and were 100% of the new material was being deposited were measured. This test was preformed 40 times. Table 3 shows the results. An average of 1.92  of material must be extruded before any change in the material composition, and 3.12  of material must be extruded before a 100% change in the material. Interestingly, a step function command was given to change the material but the delayed response was not a step function but instead gradual change. In addition, the change filament did not give consistent results as can be seen by the relatively high standard deviation of the measurements and visual inspection of Figure 8. 

Figure 8. Response Test Example. The Change Ratio Command Was Given At Red Arrow. The First Visual Detection Of Change Is At The Green Arrow. 100% Change Is At The Black Arrow.

Table 3. Response Test Results

Horizontal Distance before

Begin to see Change, mm

100% Change, mm

Average distance traveled (n=40), 

11.49

18.71

Std dev distanced traveled, 

1.96

2.36

Extrusion multiplier (extrude/travel distance)

0.069

0.069

Extruder motor distance average, 

0.79

1.30

Extruder motor distance Std dev, 

0.13

0.16

Filament cross section area 

2.40

2.40

Material extruded average, 

1.92

3.12

Material extruded Std dev, 

0.32

0.39

Average volume (Begin to see Change and 100% Change), 

2.52

Open Loop Controller

Based on the information from the response test, an open loop controller can be designed so that change ratio commands are given ahead of time while taking into account the delayed response. This controller should theoretically be able to take any existing Gcode and a material distribution representation and modify the Gcode by inserting the correct change ratio commands ahead time. 

A python program implemented this open loop controller. Because a step input results in delayed gradual response, the average of when change is first seen and when 100% of the material is changed was used as the delay amount. Based off Table 3 this is 2.52 .  Because the G93 command is a step function, the controller must break up existing commands into shorter segments and change the ratio after each short segment. The shorter segment length was based on the amount of material extruded and not necessarily the travel distance of the extruder head. The material composition is recalculated every 0.05 mm movement of the extruder motor which results in depositing 0.120.  Figure 9 shows the open loop controller design, and Figure 10 show a simple object printed using the open loop controller where the volume fraction composition is given in Figure 11. 

Figure 9. Open Loop Controller Sends The Change Ratio Commands 2.52  Ahead Of Time.

Figure 10.  50 By 100 mm Gradient Rectangle Printed Using The Open Loop Controller.

Although Figure 10 turned out well, other test (such as printing stripes) were not as successful because of 1.) the large standard deviation in the delayed response, and 2.) the delayed gradual response instead of a delayed step response to the step input function. Both of these issues could be solved by redesigning the extruder to have a smaller melt chamber and adding a stirring mechanism to insure the two filaments mix well. In addition, a closed loop controller would likely be helpful.

Figure 11. Percent Composition of Orange PLA For Object In Figure 10.

Level Set with FGM material in 1D

AM allows the engineer to customize not only the topology of a design but also its internal composition. Finding an optimal design for the topology and internal composition at the same is needed in order to generate a fully optimal design. The core difficulty is finding a model of the object such that an optimizer can change not only the objects topology but also the material composition. Most multi-material topology optimization methods focus on placing each material within an object at specific locations with no gradation materials, and most material optimization methods focus on finding a model for the material distribution within the object, but pre-assume a particular object topology. Xia and Wang with their discretized material model and level set optimization represent significant progress in this dual optimization [20]. Vermaak and co-workers developed a multi-material topology optimization where the boundaries between the materials are gradients [34].

The level set method is one popular way to find an optimal topology for a 2D or 3D object. The level set has advantages over the SIMP topology optimization method because it results in a clear 1-0 design where 1 represents locations with material and 0 with no material (void). In addition, the level set method may consider only the sensitivities of the regions near boundaries and only update these regions instead of the whole object. This analysis can limit the computational load required. The level set function is often reinitialized after several iterations using a signed distance function from the boundary so that the normal direction of the function at the boundary points outward. This reinitializing only preserves the location of the  iso-curve on the level set function and destroys any additional information that can be extracted from the height of the level set function.

We propose using a level set function (LSF)  that can vary from -1 to 1. The iso-curve at  defines the boundary , between the object and void. The level set function values between 0 and 1 represents the volume fraction composition of two materials. 100% material A is represented by on the boundary and 100% material B is represented by. A 50% combination of materials A and B is represented by (Figure 12). Everywhere on the LSF below 0 represents void. Using this model an optimizer can vary LSF in order to change not only the object’s topology but also its material composition. 

In order to test the idea, a simple case involving a 2D level set function with a 1D material distribution was formulated. The 2D levelset function modeled a cantilever beam composed of nylon and PLA plastics. The beam design space is 254 mm (10 in.) long, 25.4 mm (1 in.) tall, 12.7 mm (0.5 in.) thick. A load of 88.9 N (20 lbf.) is applied downward in the middle at x =127 mm. Figure 13 shows a picture of the beam and loading condition. Because only a 2D level set function,, is being used, the problem is a sizing optimization problem (since it can only change the length of the beam in 1D) and an optimal material distribution problem. However, when  is a 3D function, then the optimizer can change an object’s topology. This is demonstrated in the next section. 

Figure 12. Level Set Model For 1D FGM Beam

The function,  is modeled using a cubic spline with 6 control points at 0, 50.8, 101.6, 152.4, 203.2, and 254 mm where the control points heights are the design variables and can vary between -1.5 and 1.5 in the y direction. At  the material is 100% PLA, while at  the material is 100% Nylon. The void region’s elastic modulus is modeled as 1 in order to prevent singularity solutions in the finite element program. A finite element program calculated the displacement in the negative y direction of the point  for a beam that is 100% PLA and 100% Nylon. The displacement was 1.06 and 2.013 mm respectively. Based off these displacements, the target displacement for the FGM beam is set to 1.58 mm, which is the average of the 100% Nylon and 100% PLA beams. By using the average as a target displacement, the final design requires using both Nylon and PLA materials. The material properties of the mixed materials are calculated using a simple linear interpolation between the properties of the two materials. 

Anticipating manufacturing of this FGM beam using the Big Builder FDM printer, design for manufacturing rules are applied to the design. First, printing a 1D gradient in the Z direction is preferred because it is the easiest to generate the Gcode. Therefore, the cantilever beam is manufactured vertically where the fixed end of the beam is on the base of the print bed. This orientation will cause the gradient to be printed in the Z direction.

Second, FDM machines without a heated build platform and enclosed heated build chamber do not print well plastics with high thermal expansion and contraction (such as ABS and Nylon) because the printed object will warp significantly. This manufacturing constraint limits most inexpensive FDM printers to only print PLA, which has a low thermal expansion coefficient. However, with the Big Builder, we found that printing a PLA base and transitioning to Nylon allowed us to use Nylon without significant warping. So, applying the DFM rule of avoiding printing a nylon base, the control point at  (which is the base of the beam when it is manufactured) is held to at 0 which represents 100% PLA. Many other DFM rules exist for FDM printing, and Adam and Zimmer present a comprehensive set of DFM using AM [35].

In addition, because nylon in general is more difficult to print than PLA, we formulate the design problem to minimize the use of nylon. A cost function is defined where nylon = 2, PLA = 1, and void = 0. This cost function is evaluated at 100 evenly spaced points along the beam and then normalized by dividing by 100. The optimization problem is given as: 

The problem was encoded and cost was minimized using a genetic algorithm with a population size of 10 and 100 generations. Figure 13 shows the level set function  found by the optimizer, the effective elastic modulus, and the effective cost as a function of the distance along the beam. 

	

Figure 13 Optimal Design For A Cantilever Beam Using 6 Control Points

The optimal design cuts off the beam at  which is expected since everything in the interval  is not carrying load and does not affect the displacement constraint. Some of the control points that are less than 0 still affect the gradient of the material in the object  because they affect the curvature of the spline.  

The optimal design was manufactured on the Big Builder FDM printer. First, the .stl file for a homogeneous beam that represents the design space is sliced using slic3r. Next, a python program reads the spline control points from a text file and modifies the homogenous beam’s Gcode in order to produce the Gcode needed to make the FGM beam. Finally, the Gcode is sent to the printer for manufacturing of the FGM beam. Figure 14 shows the results with the level set function super imposed overtop. The PLA plastic is orange, and the Nylon is white. 

The number of control points was increased to 11 in order to test how the additional points would affect the result. Figure 15 shows the optimal results. The additional control points did decrease the cost objective, but the general shape of the optimal design is nearly identical.

Figure 14 Level Set Function Overlaid On Top Of The Manufactured FGM Beam. Orange PLA Is At . White Nylon Is At . 

Figure 15 Optimal Design For A Cantilever Beam Using 11 Control Points

Level Set with FGM material in 2D

In order to validate our model and optimization technique, we used a standard Messerschmitt-Bölkow-Blohm beam (MBB) design problem that is often used in the literature to test topology optimization techniques. A 3D cubic spline with 65 control points models the level set function  over the 50.8 by 152.4 mm (2 by 6 inch) design domain.  Figure 16 shows the boundary conditions. 

Figure 16 MMB Truss Design Problem

An 88.9 N (20 lbf.) load was applied to the beam. For the level set function,  represented nylon, and  represented PLA. In order to setup of the problem similarly to what is found in the literature, the cost of both materials was set to 1. The material property within each FEA element is found by evaluating the cubic spline function at the center of the element to find the ratio of materials and then a linear interpolation of the material properties is used.

We first attempted to minimize the maximum stress within the beam while applying a constraint on the ratio of material and void. However, we found that the volume of material constraint caused the genetic algorithm to give unrealistic results. In order to overcome this problem, we reformulated the problem to use a dual objective.

 In order to consider the actual material properties of both material, the max stress within the object was considered as part of the optimization problem. The max stress was kept below the approximate yield strength of PLA which is around 20.7 MPa. To calculate a minimum bound on the max stress within the beam, we modeled the whole beam as 100% solid PLA and found the max stress within the beam as 3.4 MPa using FEA. This min and max were used to normalize the max vonMises stress. 

Figure 17 (Upper) The Level Set Function Is Modeled In 3D With The Iso-Curve Shown In Black. (Lower) The Levelset Function Projection Into The XY Plane Is Shown.

In addition, the amount of material used by the optimal design should be minimized. The two objectives of minimize material, and minimize the vonMises stress were encoded into the problem. An upper bounds on the max displacement and max stress were also added to the optimization problem to ensure the truss was sufficiently stiff and that the vonMises stress did not go above the yield strength. The two objectives were weighted with different values in order to find a Pareto  front of optimal designs. 

Where	 

The weights were systematically changed to produce a Pareto front of optimal designs. Figure 18 shows just one of the optimal designs for  found by the genetic algorithm.

Figure 18. Design With . (Top) The Level Set Function. The Red Dots Show The XY Position Of The Control Points. (Bottom) Optimal Design Showing Percentage PLA At Each Point

We expected the output of the optimization to be truss design similar to what is found in the topology optimization literature; however, our results only partially looks like the expected truss design. The effect of using FGM material may have significantly influenced the final topology. Our model and optimization has several limitations. First, the genetic algorithm has difficulty with the truss design problem. In order for new truss members to be added to the design, which would be a significant change in topology, then several design variables would have to mutate together in order for the resulting design to decrease the objective function. Xia and Wang’s gradient based method of topology and material distribution optimization worked better than our method on the truss design problem [20].

Finding the gradient of the objective in terms of the design variables for many FGM design problems is difficult. Several researchers sought to find an optimal material distribution within a fixed design domain (not changing the topology of the object), using genetic algorithms or particle swarm techniques because of the difficulty in finding the gradient [12, 16, 18]. Our model and technique is better suited for problems where formulating the gradient based topology optimization problems is difficult. For example, optimizing an electronics enclosure where the design should maximize conductive heat transfer away from an internal heat source (such as a computer CPU) and maximize convectional heat transfer away from the surface of the enclosure while maximizing stiffness of the enclosure and subject to some limit on the amount of material that can be used. Because convective heat transfer is dependent on the overall outer shape of the design and requires simulations to calculate, finding an analytical equation for the objective or the objective’s gradient is not possible.

 Hiller and Lipson also used a genetic algorithm for their topology optimization that sought to have beams deflect into predefined curves when a load is applied [12]. Their beam design and our 1D cantilever beam design problem show the potential advantage of a genetic algorithm when it is not clear how to formulate a gradient optimization problem in order to achieve target displacements or some other complex objective.

Decoupling the location of the control points from features of the object is a significant advantage over other internal material representations that use the distance from a feature and a blending function to determine material composition [7].  This advantage is because the features may not be known a priori to the material design, such as when using topology optimization. In addition, the distance from a feature is a linear function, but optimal material composition function designs found in this paper and others are non-linear functions [13, 20, 27]. However, our level set method has a different problem. The material distribution function affects the topology and the topology affects the material distribution. This coupling helped reduce the number of design variables that would be needed if the two models were decoupled, but the coupling influenced the optimal results. Xia and Wang’s optimal results have the stiffest material in the center of each member of the truss [20]. However, with our model in order to insert the stiff PLA, a significant amount of nylon must also be added because the interface between void and PLA must pass through nylon. Perhaps if we had let the design variables range from  then we would have seen a steeper gradient that would more easily allow PLA to be embedded in thin truss members. 

Finally, the gradient based topology optimization methods require significantly fewer calls to the FEA analysis than using a genetic algorithm. However, the genetic algorithm allows for parallel computing of the individual design candidates. For the MMB design problem, we evaluated 16 individual designs at a time in parallel. For designs requiring a more computationally expensive analysis, using an optimization method that minimized the number of calls to the analysis routine would be preferred. 

Conclusions

An inexpensive off the shelf FDM printer with two motors pushing filament into one nozzle was used to print FGM objects. A complete design to manufacturing example shows how a FGM part is modeled using a level set with gradient, how the object is optimized using a genetic algorithm, and how the necessary machine codes are generated to manufacture the object.

Several printing tests show the FDM printer’s ability to print FGM objects and the printer’s limitations. We observed that the printer did not mix the two different plastics from different filaments well. Uneven gradients from the back to the front of the object while printing a Z direction gradient and stripes on flat surfaces demonstrate the need for a better mixing mechanism within the printer head. We found that future FDM FGM printers will require a mixing mechanism within the melt chamber. 

 The printer was helpful for visualizing gradient designs and establishing a design to manufacturing workflow for FGM objects using a FDM printer. We showed how the Gcode necessary to command the printer can be generated using an open loop controller and by making a discretized gradient. This Gcode generation process does not require developing a new slicer/toolpath planner but instead allows reuse of a common open source slicer. 

A new design method is proposed that finds an optimal topology and material gradient by modeling an object using a level set function. An iso-curve on the level set function specifies the object’s boundaries, and the evaluation of the level set function above the iso-curve represents the ratio of mixing two different materials. A cantilever beam was modeled using this level set method and a genetic algorithm found optimal designs while considering AM manufacturing constraints for the Big Builder. The level set function was then passed to a manufacturing software tool chain that allowed AM of the beam using the Big Builder FDM printer. 

Finally, we applied our levelset model with a genetic algorithm to the MMB beam problem that is commonly solved in the topology optimization literature. Our results did not turn out as a clearly defined truss as we expected, but show promise that with future refinement the results can be improved. Our level set model with a gradient provides a more generic method of setting up complex FGM optimization problems that involve changing topology and finding an optimal material distribution than other techniques found in the literature. This allows the technique to be applied to a wide range of problems.

In the future, we plan to continue testing and modifying the Big Builder 3D printer in order to produce higher quality FGM objects. Once the quality of the FGM printing is higher, we plan to do mechanical testing on the FGM objects to validate design objectives. In addition to improving manufacturing, we also plan to refine our level set with material gradient on 3D object design while incorporating additional improvements to the FGM design method. 

All the programs and their source code used in the experiments section and the level set optimization method is made open source to facilitate farther research [37].

References

[1] Sobczak, J. J., and Drenchev, L., 2013, "Metallic Functionally Graded Materials: A Specific Class of Advanced Composites," Journal of Materials Sciences and Technology, 29(4) pp. 297-316.

[2] Cui, W., and Wisnom, M., 1993, "A Combined Stress-Based and Fracture-Mechanics-Based Model for Predicting Delamination in Composites," Composites, 24(6) pp. 467-474.

[3] Tymrak, B., Kreiger, M., and Pearce, J., 2014, "Mechanical Properties of Components Fabricated with Open-Source 3-D Printers Under Realistic Environmental Conditions," Materials & Design, 58pp. 242-246.

[4] Garland, A., Mocko, G., and Fadel, G., 2014, "Challenges in Designing and Manufacturing Fully Optimized Functional Gradient Material Objects," ASME 2014 International Design Engineering Technical Conferences and Computers and Information in Engineering Conference, Anonymous American Society of Mechanical Engineers, pp. V02BT03A016-V02BT03A016. 

[5] Blouin, V. Y., Oschwald, M., Hu, Y., 2005, "Design of Functionally Graded Structures for Enhanced Thermal Behavior," ASME 2005 International Design Engineering Technical Conferences and Computers and Information in Engineering Conference, Anonymous ASME, pp. 835-843. 

[6] Kou, X., and Tan, S., 2007, "Heterogeneous Object Modeling: A Review," Computer-Aided Design, 39(4) pp. 284-301.

[7] Kou, X., and Tan, S., 2005, "A Hierarchical Representation for Heterogeneous Object Modeling," Computer-Aided Design, 37(3) pp. 307-319.

[8] Ozbolat, I. T., and Khoda, A., 2014, "Design of a New Parametric Path Plan for Additive Manufacturing of Hollow Porous Structures with Functionally Graded Materials," Journal of Computing and Information Science in Engineering, 14(4) pp. 041005.

[9] Rozvany, G. I. N., 2009, "A Critical Review of Established Methods of Structural Topology Optimization," Structural and Multidisciplinary Optimization, 37(3) pp. 217-237.

[10] Cansizoglu, O., Harrysson, O. L., West II, H. A., 2008, "Applications of Structural Optimization in Direct Metal Fabrication," Rapid Prototyping Journal, 14(2) pp. 114-122.

[11] Muir, M., 2013, "Multidisciplinary Optimisation of a Business Jet Main Exit Door Hinge for Production by Additive Manufacturing," .

[12] Hiller, J. D., and Lipson, H., 2009, "Multi material topological optimization of structures and mechanisms," Proceedings of the 11th Annual conference on Genetic and evolutionary computation, Anonymous ACM, pp. 1521-1528. 

[13] Huang, J., and Fadel, G. M., 2000, "Heterogeneous Flywheel Modeling and Optimization," Materials & Design, 21(2) pp. 111-125.

[14] Kou, X., and Tan, S., 2007, "A Systematic Approach for Integrated Computer-Aided Design and Finite Element Analysis of Functionally-Graded-Material Objects," Materials & Design, 28(10) pp. 2549-2565.

[15] Kou, X., and Tan, S., 2008, "Heterogeneous Objects Modelling and Applications,"Springer, pp. 42-59.

[16] Kou, X., Parks, G., and Tan, S., 2012, "Optimal Design of Functionally Graded Materials using a Procedural Model and Particle Swarm Optimization," Computer-Aided Design, 44(4) pp. 300-310.

[17] Cho, J., and Ha, D., 2002, "Optimal Tailoring of 2D Volume-Fraction Distributions for Heat-Resisting Functionally Graded Materials using FDM," Computer Methods in Applied Mechanics and Engineering, 191(29) pp. 3195-3211.

[18] Cho, J., and Ha, D., 2002, "Volume Fraction Optimization for Minimizing Thermal Stress in NiAl2O3 Functionally Graded Materials," Materials Science and Engineering: A, 334(1) pp. 147-155.

[19] Ramani, A., 2011, "Multi-Material Topology Optimization with Strength Constraints," Structural and Multidisciplinary Optimization, 43(5) pp. 597-615.

[20] Xia, Q., and Wang, M. Y., 2008, "Simultaneous Optimization of the Material Properties and the Topology of Functionally Graded Structures," Computer-Aided Design, 40(6) pp. 660-675.

[21] Gao, T., and Zhang, W., 2010, "Topology Optimization Involving Thermo-Elastic Stress Loads," Structural and Multidisciplinary Optimization, 42(5) pp. 725-738.

[22] Wang, M. Y., and Wang, X., 2004, "“Color” Level Sets: A Multi-Phase Method for Structural Topology Optimization with Multiple Materials," Computer Methods in Applied Mechanics and Engineering, 193(6) pp. 469-496.

[23] Cho, J., and Shin, S., 2004, "Material Composition Optimization for Heat-Resisting FGMs by Artificial Neural Network," Composites Part A: Applied Science and Manufacturing, 35(5) pp. 585-594.

[24] Hu, Y., Blouin, V. Y., and Fadel, G. M., 2008, "Design for Manufacturing of 3D Heterogeneous Objects with Processing Time Consideration," Journal of Mechanical Design, 130pp. 031701.

[25] Vaezi, M., Chianrabutra, S., Mellor, B., 2013, "Multiple Material Additive manufacturing–Part 1: A Review: This Review Paper Covers a Decade of Research on Multiple Material Additive Manufacturing Technologies which can Produce Complex Geometry Parts with Different Materials," Virtual and Physical Prototyping, 8(1) pp. 19-50.

[26] Shin, K., Natu, H., Dutta, D., 2003, "A Method for the Design and Fabrication of Heterogeneous Objects," Materials & Design, 24(5) pp. 339-353.

[27] Morvan, S., Fadel, G. M., Love, J., 2001, "Manufacturing of a heterogeneous flywheel on a LENS apparatus," Proceedings of the 12th solid freeform fabrication symposium, Austin, TX, Anonymous pp. 553-560. 

[28] Bruyas, A., Geiskopf, F., and Renaud, P., 2014, "Towards Statically Balanced Compliant Joints Using Multimaterial 3D Printing," ASME 2014 International Design Engineering Technical Conferences and Computers and Information in Engineering Conference, Anonymous American Society of Mechanical Engineers, pp. V05AT08A033-V05AT08A033. 

[29] Keating, S., and Oxman, N., 2013, "Compound Fabrication: A Multi-Functional Robotic Platform for Digital Design and Fabrication," Robotics and Computer-Integrated Manufacturing, 29(6) pp. 439-448.

[30] Es-Said, O., Foyos, J., Noorani, R., 2000, "Effect of Layer Orientation on Mechanical Properties of Rapid Prototyped Samples," Materials and Manufacturing Processes, 15(1) pp. 107-122.

[31] Vega, V., Clements, J., Lam, T., 2011, "The Effect of Layer Orientation on the Mechanical Properties and Microstructure of a Polymer," Journal of Materials Engineering and Performance, 20(6) pp. 978-988.

[32] Ranellucci, A., "Slic3r: Http://Slic3r.Org," .

[33] Setoodeh, S., Abdalla, M., and Gürdal, Z., 2005, "Combined Topology and Fiber Path Design of Composite Layers using Cellular Automata," Structural and Multidisciplinary Optimization, 30(6) pp. 413-421.

[34] Vermaak, N., Michailidis, G., Parry, G., 2014, "Material Interface Effects on the Topology Optimizationof Multi-Phase Structures using a Level Set Method," Structural and Multidisciplinary Optimization, 50(4) pp. 623-644.

[35] Adam, G. A., and Zimmer, D., 2014, "Design for Additive Manufacturing—Element Transitions and Aggregated Structures," CIRP Journal of Manufacturing Science and Technology, 7(1) pp. 20-28.

[36] Sigmund, O., 2001, "A 99 Line Topology Optimization Code Written in Matlab," Structural and Multidisciplinary Optimization, 21(2) pp. 120-127.

[37] Garland, A., 2015, "Source Code. Https://Github.Com/Garland3/clemsonPhD," 2015(January) .

 

	

Figures

	Figure 1. Big Builder Extruder Head

	Figure 2 Simplified Rendering Of The Extruder Head

	Figure 3. Blue PLA Transitioning To Gray PLA. Uneven Mixing From Back (Left) To Front (Right)

	Figure 4. Cross Section Rendering Of The Melt Chamber. Uneven Mixing Within The Chamber Causes Stripes To Be Printed And Uneven Mixing From Back To Front Of A Single Object.

	Figure 5. Discretized Gradient Workflow

	Figure 6. Functional Gradient Discretized Into 11 Regions

	Figure 7. 3D Printed Bar With Discretized Gradient (139.7  mm  By 25.4 mm By 12.7 mm)

	Figure 8. Response Test Example. The Change Ratio Command Was Given At Red Arrow. The First Visual Detection Of Change Is At The Green Arrow. 100% Change Is At The Black Arrow.

	Figure 9. Open Loop Controller Sends The Change Ratio Commands 2.52  Ahead Of Time.

	Figure 10.  50 By 100 mm Gradient Rectangle Printed Using The Open Loop Controller.

	Figure 11. Percent Composition of Orange PLA For Object In Figure 10.

	Figure 12. Level Set Model For 1D FGM Beam

	Figure 13 Optimal Design For A Cantilever Beam Using 6 Control Points

	Figure 14 Level Set Function Overlaid On Top Of The Manufactured FGM Beam. Orange PLA Is At . White Nylon Is At .

	Figure 15 Optimal Design For A Cantilever Beam Using 11 Control Points

	Figure 16 MMB Truss Design Problem

	Figure 17 (Upper) The Level Set Function Is Modeled In 3D With The Iso-Curve Shown In Black. (Lower) The Levelset Function Projection Into The XY Plane Is Shown.

	Figure 18. Design With . (Top) The Level Set Function. The Red Dots Show The XY Position Of The Control Points. (Bottom) Optimal Design Showing Percentage PLA At Each Point

	Tables

	Table 1. AM Machines Capable Of Manufacturing FGM Objects

	Table 2. 3D Printed Materials

	Table 3. Response Test Results